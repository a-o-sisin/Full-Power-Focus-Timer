<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta property="og:title" content="é›†ä¸­ï¼†ä¼‘æ†©ã‚¿ã‚¤ãƒãƒ¼">
    <title>é›†ä¸­ï¼†ä¼‘æ†©ã‚¿ã‚¤ãƒãƒ¼</title>
    <style>
        :root {
            --work-color: #4A90E2; /* ä½œæ¥­ï¼šé’ */
            --break-color: #50E3C2; /* ä¼‘æ†©ï¼šç·‘ */
            --cursor-color: #FF5722; /* ç¾åœ¨åœ°ï¼šã‚ªãƒ¬ãƒ³ã‚¸ */
            --bg-color: #f0f2f5;
            --text-color: #333;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* heightã‹ã‚‰å¤‰æ›´ã—ã¦ã‚¹ãƒãƒ›ã§ã®è¡¨ç¤ºå´©ã‚Œé˜²æ­¢ */
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.5s;
        }

        /* è¨­å®šã‚¨ãƒªã‚¢ */
        .settings {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            background: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        label {
            font-size: 0.8rem;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        input[type="number"] {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºéƒ¨ */
        .timer-wrapper {
            position: relative;
            width: 300px; /* å°‘ã—ç¸®å°ã—ã¦ã‚¹ãƒãƒ›ã«æœ€é©åŒ– */
            height: 300px;
            margin: 20px 0;
        }

        svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        circle {
            fill: none;
            stroke-width: 20;
            transition: stroke-dasharray 0.5s;
        }

        /* èƒŒæ™¯ç”¨ */
        .base-circle { stroke: #e6e6e6; }
        /* ä½œæ¥­æ™‚é–“ã®ã‚¢ãƒ¼ã‚¯ */
        .work-arc { stroke: var(--work-color); }
        /* ä¼‘æ†©æ™‚é–“ã®ã‚¢ãƒ¼ã‚¯ */
        .break-arc { stroke: var(--break-color); }

        /* ç¾åœ¨ä½ç½®ã‚’ç¤ºã™ãƒã‚¤ãƒ³ã‚¿ãƒ¼ */
        .cursor-point {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            transition: transform 0.1s linear;
        }
        
        .cursor-point::after {
            content: '';
            position: absolute;
            top: 10px; 
            left: 50%;
            width: 16px; height: 16px;
            background-color: #fff;
            border: 4px solid var(--cursor-color);
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* ä¸­å¤®ã®ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ± */
        .info-display {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 80%;
        }

        .main-time {
            font-size: 3rem;
            font-weight: bold;
            display: block;
            line-height: 1.2;
            color: #333;
        }

        .sub-message {
            display: block;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
            min-height: 1.5em;
        }

        .praise-message {
            color: #E91E63;
            font-weight: bold;
            font-size: 1.1rem;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        button {
            padding: 12px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        #startBtn { background-color: var(--work-color); color: white; }
        #startBtn:hover { background-color: #357ABD; transform: translateY(-2px); }
        #resetBtn { background-color: #fff; color: #666; border: 1px solid #ddd; }
        #resetBtn:hover { background-color: #f8f8f8; }

        /* ä»Šæ—¥ã®å®Ÿç¸¾ã‚¨ãƒªã‚¢ */
        .daily-stats {
            background: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            width: 85%;
            max-width: 320px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stats-title {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 8px;
            display: block;
            font-weight: bold;
        }

        .stats-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 1rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #aaa;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 2px;
        }
        
        .work-stat { color: var(--work-color); }
        .break-stat { color: var(--break-color); }

    </style>
</head>
<body>

    <div class="settings">
        <div class="input-group">
            <label>ä½œæ¥­(åˆ†)</label>
            <input type="number" id="workInput" value="50" min="1">
        </div>
        <div class="input-group">
            <label>ä¼‘æ†©(åˆ†)</label>
            <input type="number" id="breakInput" value="10" min="1">
        </div>
    </div>

    <div class="timer-wrapper">
        <svg viewBox="0 0 320 320">
            <circle class="base-circle" cx="160" cy="160" r="140"></circle>
            <circle class="work-arc" cx="160" cy="160" r="140"></circle>
            <circle class="break-arc" cx="160" cy="160" r="140"></circle>
        </svg>
        
        <div class="cursor-point" id="cursorPoint"></div>

        <div class="info-display">
            <span class="sub-message" id="topMsg">æº–å‚™å®Œäº†</span>
            <span class="main-time" id="timeDisplay">--:--</span>
            <span class="sub-message" id="btmMsg">ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­</span>
        </div>
    </div>

    <div class="controls">
        <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="daily-stats">
        <span class="stats-title" id="statsDate">--æœˆ--æ—¥ã®å®Ÿç¸¾</span>
        <div class="stats-content">
            <div class="stat-item">
                <span class="stat-label">ä½œæ¥­</span>
                <span class="stat-value work-stat" id="totalWorkTime">0åˆ†</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ä¼‘æ†©</span>
                <span class="stat-value break-stat" id="totalBreakTime">0åˆ†</span>
            </div>
        </div>
    </div>

    <script>
        // --- è¨­å®šã¨å®šæ•° ---
        const RADIUS = 140;
        const CIRCUMFERENCE = 2 * Math.PI * RADIUS;
        const workInput = document.getElementById('workInput');
        const breakInput = document.getElementById('breakInput');
        
        // --- è¦ç´ ã®å–å¾— ---
        const workArc = document.querySelector('.work-arc');
        const breakArc = document.querySelector('.break-arc');
        const cursorPoint = document.getElementById('cursorPoint');
        const timeDisplay = document.getElementById('timeDisplay');
        const topMsg = document.getElementById('topMsg');
        const btmMsg = document.getElementById('btmMsg');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        // å®Ÿç¸¾è¡¨ç¤ºç”¨è¦ç´ 
        const statsDate = document.getElementById('statsDate');
        const totalWorkElem = document.getElementById('totalWorkTime');
        const totalBreakElem = document.getElementById('totalBreakTime');

        // --- çŠ¶æ…‹ç®¡ç† ---
        let totalCycleSeconds = 0;
        let workSeconds = 0;
        let breakSeconds = 0;
        
        let startTime = 0;    
        let pausedTime = 0;   
        let timerInterval = null;
        let isRunning = false;
        
        let lastTickSec = 0;
        
        // ä»Šæ—¥ã®å®Ÿç¸¾ç”¨å¤‰æ•°
        let dailyWorkSec = 0;
        let dailyBreakSec = 0;
        let todayStr = ""; // YYYY-MM-DDå½¢å¼

        let audioCtx = null;
        let wakeLock = null;

        const praiseMessages = [
            "å¤©æ‰çš„ãªé›†ä¸­åŠ›ã§ã—ãŸï¼", "ç´ æ™´ã‚‰ã—ã„ï¼ã‚†ã£ãã‚Šä¼‘ã‚“ã§ï¼",
            "ãã®èª¿å­ï¼ã‚ãªãŸã¯æœ€é«˜ã§ã™ï¼", "å®Œç’§ãªä»•äº‹ã¶ã‚Šã§ã™ï¼",
            "ã™ã”ã„ï¼ç›®æ¨™é”æˆãŠã‚ã§ã¨ã†ï¼", "ç¥ãŒã‹ã£ãŸé›†ä¸­åŠ›ï¼"
        ];

        // --- åˆæœŸåŒ– ---
        function initTimer() {
            const wMin = parseInt(workInput.value);
            const bMin = parseInt(breakInput.value);
            workSeconds = wMin * 60;
            breakSeconds = bMin * 60;
            totalCycleSeconds = workSeconds + breakSeconds;

            // å††ã‚°ãƒ©ãƒ•æç”»
            const workRatio = workSeconds / totalCycleSeconds;
            const workDash = workRatio * CIRCUMFERENCE;
            workArc.style.strokeDasharray = `${workDash} ${CIRCUMFERENCE}`;
            workArc.style.strokeDashoffset = 0;

            const breakRatio = breakSeconds / totalCycleSeconds;
            const breakDash = breakRatio * CIRCUMFERENCE;
            breakArc.style.strokeDasharray = `${breakDash} ${CIRCUMFERENCE}`;
            breakArc.style.strokeDashoffset = -workDash;

            updateVisuals(0);
        }

        // --- å®Ÿç¸¾ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---
        function loadDailyStats() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            todayStr = `${year}-${month}-${day}`; // ã‚­ãƒ¼ä½œæˆ

            // è¡¨ç¤ºç”¨æ—¥ä»˜æ›´æ–°
            statsDate.textContent = `ğŸ“… ${month}æœˆ${day}æ—¥ã®å®Ÿç¸¾`;

            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
            const savedData = localStorage.getItem(`timer_stats_${todayStr}`);
            if (savedData) {
                const parsed = JSON.parse(savedData);
                dailyWorkSec = parsed.work || 0;
                dailyBreakSec = parsed.break || 0;
            } else {
                dailyWorkSec = 0;
                dailyBreakSec = 0;
            }
            updateStatsDisplay();
        }

        function saveDailyStats() {
            const data = {
                work: dailyWorkSec,
                break: dailyBreakSec
            };
            localStorage.setItem(`timer_stats_${todayStr}`, JSON.stringify(data));
        }

        function updateStatsDisplay() {
            totalWorkElem.textContent = `${Math.floor(dailyWorkSec / 60)}åˆ†`;
            totalBreakElem.textContent = `${Math.floor(dailyBreakSec / 60)}åˆ†`;
        }

        // --- ç´¯ç©åŠ ç®—ãƒ­ã‚¸ãƒƒã‚¯ (é‡è¦) ---
        function accumulateTime(prevSec, currSec) {
            // æ™‚é–“ãŒæˆ»ã£ã¦ã„ã‚‹ã€ã‚‚ã—ãã¯å¤‰åŒ–ãŒãªã„å ´åˆã¯ç„¡è¦–
            if (currSec <= prevSec) return;

            // ä»Šå›çµŒéã—ãŸåŒºé–“: [start, end]
            const start = prevSec;
            const end = currSec;

            // 1. ä½œæ¥­æ™‚é–“ã¸ã®åŠ ç®— (0 ï½ workSeconds ã®ç¯„å›²ã¨é‡ãªã‚‹éƒ¨åˆ†)
            // é‡ãªã‚Š = Math.min(end, workSeconds) - Math.max(start, 0)
            const workOverlapStart = Math.max(start, 0);
            const workOverlapEnd = Math.min(end, workSeconds);
            if (workOverlapEnd > workOverlapStart) {
                dailyWorkSec += (workOverlapEnd - workOverlapStart);
            }

            // 2. ä¼‘æ†©æ™‚é–“ã¸ã®åŠ ç®— (workSeconds ï½ totalCycleSeconds ã®ç¯„å›²ã¨é‡ãªã‚‹éƒ¨åˆ†)
            const breakOverlapStart = Math.max(start, workSeconds);
            const breakOverlapEnd = Math.min(end, totalCycleSeconds);
            if (breakOverlapEnd > breakOverlapStart) {
                dailyBreakSec += (breakOverlapEnd - breakOverlapStart);
            }
            
            saveDailyStats();
            updateStatsDisplay();
        }

        // --- è¡¨ç¤ºæ›´æ–° ---
        function updateVisuals(currentSec) {
            if (currentSec > totalCycleSeconds) currentSec = totalCycleSeconds;

            let isWorkPhase = currentSec < workSeconds;
            let displayTimeSeconds = 0;

            if (isWorkPhase) {
                displayTimeSeconds = workSeconds - currentSec;
                timeDisplay.style.color = "#333";
                if(isRunning) {
                    topMsg.textContent = "ä½œæ¥­ä¸­";
                    btmMsg.textContent = `ã‚ã¨${Math.ceil(displayTimeSeconds/60)}åˆ†ï¼é ‘å¼µã‚ã†ï¼`;
                    btmMsg.className = "sub-message";
                }
            } else {
                displayTimeSeconds = totalCycleSeconds - currentSec;
                timeDisplay.style.color = "var(--break-color)";
                if(isRunning) {
                    topMsg.textContent = "ä¼‘æ†©ä¸­";
                    if (!btmMsg.classList.contains('praise-message')) {
                         btmMsg.textContent = "ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦ã­";
                    }
                }
            }

            const m = Math.floor(displayTimeSeconds / 60).toString().padStart(2, '0');
            const s = (displayTimeSeconds % 60).toString().padStart(2, '0');
            timeDisplay.textContent = `${m}:${s}`;

            const progressRatio = currentSec / totalCycleSeconds;
            const degrees = progressRatio * 360;
            cursorPoint.style.transform = `rotate(${degrees}deg)`;
        }

        // --- éŸ³å£° (Beep) ---
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playBeep(type) {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'short') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'long') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                oscillator.frequency.setValueAtTime(1760, audioCtx.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime + 0.2);
                oscillator.frequency.setValueAtTime(1760, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            }
        }

        // --- Screen Wake Lock ---
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (err) {
                console.error(`${err.name}, ${err.message}`);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release()
                    .then(() => {
                        wakeLock = null;
                    });
            }
        }

        // --- é€²è¡Œãƒ­ã‚¸ãƒƒã‚¯ ---
        function tick() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            let currentSec = elapsed; 

            if (currentSec > totalCycleSeconds) {
                // çµ‚äº†ç›´å‰ã®å·®åˆ†ã‚‚åŠ ç®—ã—ã¦ã‹ã‚‰çµ‚äº†
                accumulateTime(lastTickSec, totalCycleSeconds);
                finishCycle();
                return;
            }

            // å‰å›tickã‹ã‚‰ã®çµŒéæ™‚é–“ã‚’å®Ÿç¸¾ã«åŠ ç®—
            // ç”»é¢ã‚ªãƒ•ã§æ™‚é–“ãŒé£›ã‚“ã§ã‚‚ã€ã“ã“ã§ã€Œé£›ã‚“ã åˆ†ã€ã‚’è¨ˆç®—ã—ã¦åŠ ç®—ã—ã¾ã™
            accumulateTime(lastTickSec, currentSec);

            // éŸ³åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            if (lastTickSec < workSeconds && currentSec >= workSeconds) {
                playBeep('long');
                showPraise();
            }
            else if (currentSec < workSeconds) {
                const step = Math.floor(workSeconds * 0.2);
                const prevStepCount = Math.floor(lastTickSec / step);
                const currStepCount = Math.floor(currentSec / step);
                
                if (currStepCount > prevStepCount && lastTickSec > 0) {
                     playBeep('short');
                }
            }

            lastTickSec = currentSec;
            updateVisuals(currentSec);
        }

        function finishCycle() {
            playBeep('long');
            clearInterval(timerInterval);
            isRunning = false;
            releaseWakeLock(); 
            startBtn.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆ";
            alert("1ã‚µã‚¤ã‚¯ãƒ«çµ‚äº†ã§ã™ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚");
            pausedTime = 0;
            btmMsg.className = "sub-message";
            btmMsg.textContent = "ã‚‚ã†ä¸€åº¦é ‘å¼µã‚‹ï¼Ÿ";
            updateVisuals(0);
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆ ---
        startBtn.addEventListener('click', () => {
            initAudio();
            
            if (isRunning) {
                // ä¸€æ™‚åœæ­¢
                clearInterval(timerInterval);
                isRunning = false;
                releaseWakeLock(); 
                pausedTime = Math.floor((Date.now() - startTime) / 1000);
                startBtn.textContent = "å†é–‹";
            } else {
                // é–‹å§‹
                requestWakeLock(); 
                loadDailyStats(); // æ—¥ä»˜å¤‰æ›´å¯¾å¿œã®ãŸã‚é–‹å§‹æ™‚ã«ã‚‚ãƒ­ãƒ¼ãƒ‰ç¢ºèª

                if (pausedTime === 0) {
                    initTimer(); 
                    startTime = Date.now();
                    lastTickSec = 0; 
                } else {
                    // å†é–‹
                    startTime = Date.now() - (pausedTime * 1000);
                    lastTickSec = pausedTime; 
                }
                
                isRunning = true;
                startBtn.textContent = "ä¸€æ™‚åœæ­¢";
                
                const currentSec = pausedTime;
                topMsg.textContent = currentSec < workSeconds ? "ä½œæ¥­ä¸­" : "ä¼‘æ†©ä¸­";

                timerInterval = setInterval(tick, 200); 
            }
        });

        resetBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            isRunning = false;
            releaseWakeLock(); 
            pausedTime = 0;
            lastTickSec = 0;
            startBtn.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆ";
            topMsg.textContent = "æº–å‚™å®Œäº†";
            btmMsg.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­";
            btmMsg.className = "sub-message";
            initTimer();
        });

        [workInput, breakInput].forEach(input => {
            input.addEventListener('change', () => {
                if (!isRunning) {
                    pausedTime = 0;
                    initTimer();
                }
            });
        });

        // èµ·å‹•æ™‚å‡¦ç†
        initTimer();
        loadDailyStats(); // å®Ÿç¸¾èª­ã¿è¾¼ã¿
        
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                await requestWakeLock();
            }
        });

    </script>
</body>
</html>
